(desc:(eng:"# Problem\n\nWhat if we put one portal into another? This is the question that worried people since Portal game came. And this is finally solved in this demo.\n\nClarify: here we put «output» of portal into his «input», this is the reason of all difficulty of this scene. We can take 4 portals and take two not connected portals and put one into anouther without getting trouble, but this is not interesting.\n\n# Previous solution\n\nMy previous solution was published on [YouTube](https://www.youtube.com/watch?v=fWkAfa96OmI), [Reddit](https://www.reddit.com/r/Portal/comments/l9agp9/this_happens_if_you_put_one_portal_inside_another/) and [Pikabu](https://pikabu.ru/story/portal_v_portale_reshenie_problemyi_s_pomoshchyu_simulyatsii_7066445).\n\nPreviously I solved this in very difficult and naive way: by calculations on polygons and without matrices (I invented my weak coordinate system structure). And this was so difficult that by two years of half-strength development I created only one thing that you can see on the YouTube. Another scenes like triple portal in triple portal was not working because of bugs which I still can\'t understand.\n\nI always know that there must be way to solve this much easily, like brute-force. And finally I found the solution.\n\nHere everything works like ray-tracing: for each ray we find teleport teleportation degree where this ray belongs to. I solve this up to 10 teleportation degree, but this approach may works slow, and can be acceptable for a demo, but is not acceptable for game of movie.\n\nNow I am more and more convinvced that not hard work is important, but ability to find tricky and roundabout way to solve problem, ability to deep thinking.\n\n# How this works\n\nYou can disable teleportation light to better understand how this works.\n\n- Color is represent teleportation degree: Red — 1, Green — 2, Blue — 3 etc.\n- «Input» and «Output» portals must have the same shape.\n- When Red portal enters Red portal, the teleported portal will be Green, then this part is cuted from both of the portals (because previous item) and added to the green portal.\n- When Red portal enters Green, or Green enters Red, the teleported portal will be Blue, i.e. 3 degree. Degrees just sums up.\n- Portals with different colors — different portals which is just connected through space or throug another portal.\n\n# Twitter\n\n<https://twitter.com/optozorax/status/1373536393411051520>\n",rus:"# Проблема\n\nЧто будет если мы поместим один портал в другой? Вопрос, который волновал людей с момента выхода игры Portal наконец решён.\n\nУточнение: здесь мы помещаем «вход» портала в его «выход», в этом заключается вся сложность; мы можем взять 4 портала и поместить один портал в другой так чтобы не возникло проблем, но это не интересно.\n\n# Предыдущее решение\n\nПредыдущее решение я опубликовал на [YouTube](https://www.youtube.com/watch?v=fWkAfa96OmI), [Reddit](https://www.reddit.com/r/Portal/comments/l9agp9/this_happens_if_you_put_one_portal_inside_another/) и [Pikabu](https://pikabu.ru/story/portal_v_portale_reshenie_problemyi_s_pomoshchyu_simulyatsii_7066445).\n\nВ прошлый раз я делал это очень сложным и наивным способом — через вычисления над полигонами, и без матриц (сам придумал структуру системы координат). И это было настолько сложно, что за пару лет на разработки из полсилы в свободное время я смог сделать только то что можно наблюдать в видео на YouTube. Другие типы вхождения портала в портал или вхождение тройного портала в тройной портал работали с дикими багами, которые настолько сложно осознать, что я до сих пор не до конца понимаю в чём проблема, хоть я это и визуализировал миллион раз.\n\nУ меня давно были мысли о том, что это должно как-то решаться проще, должен быть подход который всё упрощает. По аналогии с тем как брутфорс позволяет решить задачу просто, но не очень быстро. И вот, наконец, я данный способ нашёл.\n\nЗдесь всё работает аналогично рей-трейсингу: для каждого луча перебираются все степени телепортации и определяется в какую он упал, и какая ближе. Я задал границу в 10 степеней телепортации, и такой подход может быть довольно медленным, что приемлемо для демки, но неприемлемо для игры или фильма.\n\nТеперь я ещё больше убеждаюсь в том, что важнее не упорный труд, а умение придумать обходной и хитрый путь, умение думать мозгами.\n\n# Как это работает\n\nМожно отключить опцию телепортации света для порталов чтобы лучше понимать что происходит. По пунктам:\n\n- Цветом показывается степень телепортации, Красный — 1, Зелёный — 2, Синий — 3 итд.\n- «Вход» и «выход» всегда обязаны совпадать по форме.\n- При входе красного портала в красный, вошедшая часть получается степень 2, и обрезается с обоих красных порталов, становится зелёной и добавляется в зелёный портал.\n- При входе красного в зелёный, зелёного в красный получается синий, степень просто суммируется.\n- Порталы с разными цветами — разные порталы, просто находящиеся рядом, и связанные через портальную поверхность.\n\n# Twitter\n\n<https://twitter.com/optozorax/status/1373536393411051520>"),cam:(look_at:(0,0,0),alpha:-12.211266308591973,beta:0.9480013310760308,r:1.9756587551882376,offset_after_material:0.000025),uniforms:(ids:(available:[],max:17),storage:{(0):Named(Float((min:Some(0),max:None,value:4)),"room_size_x"),(1):Named(Float((min:Some(0),max:None,value:4)),"room_size_y"),(2):Named(Float((min:Some(0),max:None,value:4)),"room_size_z"),(3):Inline(Formula(("-room_size_x"))),(4):Inline(Formula(("-room_size_y"))),(5):Inline(Formula(("-room_size_z"))),(6):Named(Bool(true),"teleport_light"),(7):Named(Progress(0),"progress"),(8):Inline(Formula(("1 - progress * 1.73"))),(9):Inline(Formula(("deg2rad(-90) * min(progress, 0.5) / 0.5"))),(10):Inline(Formula(("deg2rad(-90) * min(progress, 0.5) / 0.5"))),(11):Inline(Angle(0)),(12):Inline(Formula(("pi()/2 + progress"))),(13):Inline(Formula(("((time * speed) % 1) * 2 * pi()"))),(14):Named(Progress(0.1),"speed"),(15):Inline(Formula(("((time * speed) % 1) * 2 * pi()"))),(16):Inline(Formula(("((time * speed) % 1) * 2 * pi()")))},storage_order:[(0),(1),(2),(6),(7),(14)]),matrices:(ids:(available:[],max:37),storage:{(0):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"room_origin"),(1):Inline(Mul(to:Some(((2))),what:Some(((0))))),(2):Inline(Parametrized(offset:(x:Yes(Some(((0)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(3):Inline(Mul(to:Some(((4))),what:Some(((0))))),(4):Inline(Parametrized(offset:(x:Yes(Some(((3)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(5):Inline(Mul(to:Some(((6))),what:Some(((0))))),(6):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((1)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(7):Inline(Mul(to:Some(((8))),what:Some(((0))))),(8):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((4)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(9):Inline(Mul(to:Some(((10))),what:Some(((0))))),(10):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((2))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(11):Inline(Mul(to:Some(((12))),what:Some(((0))))),(12):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((5))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(13):Named(Simple(offset:(0,0,-1),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"a"),(14):Named(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((8))))),rotate:(x:Yes(Some(((9)))),y:Yes(Some(((10)))),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1)),"b0"),(15):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((14)))),"b1"),(16):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((15)))),"b2"),(17):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((16)))),"b3"),(18):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((17)))),"b4"),(19):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((18)))),"b5"),(20):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((19)))),"b6"),(21):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((20)))),"b7"),(22):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((21)))),"b8"),(23):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((22)))),"b9"),(24):Named(Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((23)))),"b10"),(25):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((8))))),rotate:(x:Yes(Some(((9)))),y:Yes(Some(((10)))),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(26):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(27):Inline(Simple(offset:(0,0,0.27),scale:1,rotate:(4.71238898038469,4.71238898038469,0),mirror:(false,false,false))),(28):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(29):Inline(Simple(offset:(0,0,0.27),scale:1,rotate:(4.71238898038469,4.71238898038469,0),mirror:(false,false,false))),(30):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(31):Inline(Simple(offset:(0,0,0.24),scale:1,rotate:(0.2792526803190927,0,0),mirror:(false,false,false))),(32):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(33):Inline(Parametrized(offset:(x:No(0),y:No(0),z:No(0.32)),rotate:(x:No(0),y:No(4.71238898038469),z:Yes(Some(((12))))),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(34):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(35):Inline(Parametrized(offset:(x:No(0),y:No(0),z:No(0.24)),rotate:(x:Yes(Some(((7)))),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(36):Inline(Simple(offset:(0,0,0.24),scale:1,rotate:(0.2792526803190927,0,0),mirror:(false,false,false)))},storage_order:[(0),(13),(14),(15),(16),(17),(18),(19),(20),(21),(22),(23),(24)]),objects:(ids:(available:[],max:17),storage:{(0):Named(Flat(kind:Simple(Some(((1)))),is_inside:(("return is_inside_square(x, y, room_size_z_u, room_size_y_u, room_yellow_M);"))),"room_x+"),(1):Named(Flat(kind:Simple(Some(((3)))),is_inside:(("return is_inside_square(x, y, room_size_z_u, room_size_y_u, room_red_M);"))),"room_x-"),(2):Named(Flat(kind:Simple(Some(((5)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_z_u, room_black_M);"))),"room_y+"),(3):Named(Flat(kind:Simple(Some(((7)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_z_u, room_gray_M);"))),"room_y-"),(4):Named(Flat(kind:Simple(Some(((9)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_y_u, room_blue_M);"))),"room_z+"),(5):Named(Flat(kind:Simple(Some(((11)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_y_u, room_green_M);"))),"room_z-"),(6):Named(Flat(kind:Portal(Some(((13))),Some(((14)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b0_mat_teleport * pos; }\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_0_M);"))),"portal0"),(7):Named(Flat(kind:Portal(Some(((13))),Some(((15)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b1_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_1_M);"))),"portal1"),(8):Named(Flat(kind:Portal(Some(((13))),Some(((16)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b2_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_2_M);"))),"portal2"),(9):Named(Flat(kind:Portal(Some(((13))),Some(((17)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b3_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b2_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_3_M);"))),"portal3"),(10):Named(Flat(kind:Portal(Some(((13))),Some(((18)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b4_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b2_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b3_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_4_M);"))),"portal4"),(11):Named(Flat(kind:Portal(Some(((13))),Some(((19)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b5_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b2_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b3_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b4_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_5_M);"))),"portal5"),(12):Named(Flat(kind:Portal(Some(((13))),Some(((20)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b6_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b2_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b3_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b4_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b5_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_6_M);"))),"portal6"),(13):Named(Flat(kind:Portal(Some(((13))),Some(((21)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b7_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b2_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b3_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b4_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b5_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b6_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_7_M);"))),"portal7"),(14):Named(Flat(kind:Portal(Some(((13))),Some(((22)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b8_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b2_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b3_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b4_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b5_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b6_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b7_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_8_M);"))),"portal8"),(15):Named(Flat(kind:Portal(Some(((13))),Some(((23)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b9_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b2_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b3_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b4_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b5_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b6_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b7_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b8_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_9_M);"))),"portal9"),(16):Named(Flat(kind:Portal(Some(((13))),Some(((24)))),is_inside:(("if (definitely_not_in_portal(x, y)) return NOT_INSIDE;\n\nvec4 pos1 = pos;\nif (first) { pos1 = a_to_b10_mat_teleport * pos; }\n\nif ((b0_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b1_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b2_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b3_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b4_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b5_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b6_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b7_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b8_mat_inv * pos1).z > 0.) return NOT_INSIDE;\nif ((b9_mat_inv * pos1).z > 0.) return NOT_INSIDE;\n\nif ((a_mat_inv * pos1).z < 0.) return NOT_INSIDE;\n\nreturn ellipse_portal(x, y, back, first, solid_10_M);"))),"portal10")},storage_order:[(0),(1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16)]),cameras:(ids:(available:[],max:6),storage:{(0):Named((look_at:MatrixCenter(Some(((13)))),alpha:-5.794107164726811,beta:0.8981089851558188,r:3.50000000000001),"a"),(1):Named((look_at:MatrixCenter(Some(((14)))),alpha:-5.794107164726811,beta:0.8981089851558188,r:3.50000000000001),"b"),(2):Inline((look_at:Coordinate((0,0,0)),alpha:-12.165700075225216,beta:0.8745012875795398,r:1.9756587551882376)),(3):Inline((look_at:Coordinate((0.14,0.14,0.135)),alpha:-13.361797514201355,beta:0.845608892008663,r:0.048017242074020104)),(4):Inline((look_at:Coordinate((0,0,0.135)),alpha:-12.511239557476001,beta:0.01,r:0.07733224853263031)),(5):Inline((look_at:Coordinate((0,0,0)),alpha:-12.355556990907772,beta:1.2000013870894954,r:1.9756587551882376))},storage_order:[(0),(1)]),textures:(ids:(available:[],max:0),storage:{},storage_order:[]),materials:(ids:(available:[],max:20),storage:{(0):Named(Simple(color:(0.7647179,0.7024815,0.061205085),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_yellow"),(1):Named(Simple(color:(0.029196177,0.029196177,0.029196177),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_black"),(2):Named(Simple(color:(0.8458183,0.07454156,0.07454156),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_red"),(3):Named(Simple(color:(0.18068509,0.18068509,0.18068509),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_gray"),(4):Named(Simple(color:(0.116810285,0.26798066,0.9083436),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_blue"),(5):Named(Simple(color:(0.15294117647058825,0.7372549019607844,0.21568627450980393),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_green"),(6):Named(Simple(color:(0.03529411764705882,0.6431372549019608,0.788235294117647),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"portal_blue"),(7):Named(Simple(color:(0.9294117647058824,0.4235294117647059,0.050980392156862744),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"portal_orange"),(8):Named(Simple(color:(0.6666666666666666,0.6666666666666666,0.6666666666666666),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"grid_gray"),(9):Named(Simple(color:(1,0.24376154,0.24376154),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_0"),(10):Named(Simple(color:(0.24376106,1,0.25302637),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_1"),(11):Named(Simple(color:(0.18710661,0.19761491,1),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_2"),(12):Named(Simple(color:(1,0.97995126,0.15473223),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_3"),(13):Named(Simple(color:(0.7078609,0.20059586,1),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_4"),(14):Named(Simple(color:(1,0.18440866,0.66435695),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_5"),(15):Named(Simple(color:(1,0.51893616,0.08458853),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_6"),(16):Named(Simple(color:(0.28545788,0.9856131,0.73604244),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_7"),(17):Named(Simple(color:(0.5713339,0.5713339,0.5713339),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_8"),(18):Named(Simple(color:(0.15266089,0.15266089,0.15266089),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_9"),(19):Named(Simple(color:(0.013828539,0.013455469,0.013455469),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_10")},storage_order:[(0),(2),(1),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19)]),library:(ids:(available:[],max:2),storage:{(0):Named((("int is_inside_square(float x, float y, float sizex, float sizey, int material) {\n  if (abs(x) < sizex && abs(y) < sizey) {\n    return material;\n  } else {\n    return NOT_INSIDE;\n  }\n}\n")),"room"),(1):Named((("int ellipse_portal(float x, float y, bool back, bool first, int not_teleport_material) {\nint material = portal_blue_M;\nif (first) material = portal_orange_M;\n\nif (2.*x*x + y*y < 1.) {\n  if (back) {\n    if (teleport_light_u == 1) {\n      return material;\n    } else {\n      return not_teleport_material;\n    }\n  } else {\n    if (teleport_light_u == 1) {\n      return TELEPORT;\n    } else {\n      return not_teleport_material;\n    }\n  }\n} else if (2.*x*x + y*y < 1.1) {\n  return material;\n} else {\n  return NOT_INSIDE;\n}\n}\n\nbool definitely_not_in_portal(float x, float y) {\n  return !(abs(x) < 2.2 && abs(y) < 2.2);\n}")),"portal")},storage_order:[(0),(1)]),animations_filters:(uniforms:({((6)):true,((2)):false,((14)):true,((1)):false,((0)):false,((7)):true}),matrices:({((14)):true,((24)):false,((13)):true,((18)):false,((23)):false,((19)):false,((15)):false,((22)):false,((21)):false,((17)):false,((16)):false,((20)):false,((0)):false}),cameras:({((0)):true,((2)):true,((1)):true})),elements_descriptions:(uniforms:({((7)):(help_description:None,overrided_name:"Progress"),((14)):(help_description:None,overrided_name:"Speed"),((6)):(help_description:None,overrided_name:"Teleport light")}),matrices:({((14)):(help_description:None,overrided_name:"Blue portal"),((13)):(help_description:None,overrided_name:"")}),cameras:({((0)):(help_description:None,overrided_name:"Orange portal"),((1)):(help_description:None,overrided_name:"Blue portal"),((2)):(help_description:None,overrided_name:"")})),user_uniforms:(uniforms:({((6)):true,((2)):false,((0)):false,((7)):false,((14)):false,((1)):false}),matrices:({((18)):false,((14)):false,((20)):false,((19)):false,((24)):false,((21)):false,((0)):false,((13)):false,((23)):false,((16)):false,((15)):false,((17)):false,((22)):false})),animation_stages:(ids:(available:[],max:6),storage:{(0):Named((name:(eng:"How",rus:"Как"),description:None,uniforms:({((6)):FromDev,((0)):FromDev,((7)):ProvidedToUser,((1)):FromDev,((2)):FromDev}),matrices:({((21)):FromDev,((0)):FromDev,((17)):FromDev,((24)):FromDev,((20)):FromDev,((22)):FromDev,((18)):FromDev,((15)):FromDev,((16)):FromDev,((19)):FromDev,((14)):Changed(Some(((25)))),((13)):FromDev,((23)):FromDev}),original_cam_button:false,set_cam:None,cams:{((1)):false,((2)):false,((0)):false}),"how"),(1):Named((name:(eng:"Explore",rus:"Исследуй"),description:None,uniforms:({((2)):FromDev,((0)):FromDev,((7)):FromDev,((1)):FromDev,((6)):FromDev}),matrices:({((14)):ChangedAndToUser(Some(((27)))),((18)):FromDev,((23)):FromDev,((20)):FromDev,((19)):FromDev,((15)):FromDev,((17)):FromDev,((13)):Changed(Some(((26)))),((22)):FromDev,((24)):FromDev,((16)):FromDev,((0)):FromDev,((21)):FromDev}),original_cam_button:true,set_cam:None,cams:{((2)):false,((1)):true,((0)):true}),"explore"),(2):Named((name:(eng:"Picture 1",rus:"Картинка 1"),description:None,uniforms:({((7)):FromDev,((0)):FromDev,((2)):FromDev,((1)):FromDev,((6)):FromDev}),matrices:({((19)):FromDev,((23)):FromDev,((0)):FromDev,((15)):FromDev,((18)):FromDev,((24)):FromDev,((17)):FromDev,((22)):FromDev,((21)):FromDev,((20)):FromDev,((13)):Changed(Some(((28)))),((14)):ChangedAndToUser(Some(((29)))),((16)):FromDev}),original_cam_button:false,set_cam:Some(Some(((3)))),cams:{((0)):false,((1)):false,((2)):false}),"picture 1"),(3):Named((name:(eng:"Picture 2",rus:"Картинка 2"),description:None,uniforms:({((7)):FromDev,((1)):FromDev,((0)):FromDev,((2)):FromDev,((6)):FromDev}),matrices:({((19)):FromDev,((21)):FromDev,((24)):FromDev,((13)):Changed(Some(((30)))),((15)):FromDev,((22)):FromDev,((23)):FromDev,((0)):FromDev,((20)):FromDev,((18)):FromDev,((17)):FromDev,((16)):FromDev,((14)):ChangedAndToUser(Some(((36))))}),original_cam_button:false,set_cam:Some(Some(((4)))),cams:{((1)):false,((2)):false,((0)):false}),"picture 2"),(4):Named((name:(eng:"Animation 1",rus:"Анимация 1"),description:None,uniforms:({((14)):ProvidedToUser,((2)):FromDev,((7)):Changed(Some(((15)))),((0)):FromDev,((1)):FromDev,((6)):FromDev}),matrices:({((15)):FromDev,((24)):FromDev,((13)):Changed(Some(((32)))),((14)):Changed(Some(((33)))),((19)):FromDev,((16)):FromDev,((23)):FromDev,((17)):FromDev,((18)):FromDev,((22)):FromDev,((21)):FromDev,((0)):FromDev,((20)):FromDev}),original_cam_button:false,set_cam:Some(Some(((2)))),cams:{((1)):false,((2)):false,((0)):false}),"animation 1"),(5):Named((name:(eng:"Animation 2",rus:"Анимация 2"),description:None,uniforms:({((14)):ProvidedToUser,((6)):FromDev,((7)):Changed(Some(((16)))),((1)):FromDev,((2)):FromDev,((0)):FromDev}),matrices:({((13)):Changed(Some(((34)))),((19)):FromDev,((14)):Changed(Some(((35)))),((21)):FromDev,((0)):FromDev,((23)):FromDev,((16)):FromDev,((20)):FromDev,((17)):FromDev,((18)):FromDev,((22)):FromDev,((15)):FromDev,((24)):FromDev}),original_cam_button:false,set_cam:Some(Some(((5)))),cams:{((2)):false,((1)):false,((0)):false}),"animation 2")},storage_order:[(0),(1),(2),(3),(4),(5)]),current_stage:Some(((0))),dev_stage:(uniforms:({((1)):Float((min:Some(0),max:None,value:4)),((7)):Progress(0),((2)):Float((min:Some(0),max:None,value:4)),((14)):Progress(0.1),((0)):Float((min:Some(0),max:None,value:4)),((6)):Bool(true)}),matrices:({((13)):Simple(offset:(0,0,-1),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((17)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((16)))),((14)):Simple(offset:(0,0,-0.73),scale:1,rotate:(4.71238898038469,4.71238898038469,0),mirror:(false,false,false)),((18)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((17)))),((20)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((19)))),((23)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((22)))),((16)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((15)))),((22)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((21)))),((21)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((20)))),((24)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((23)))),((0)):Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((19)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((18)))),((15)):Teleport(first_portal:Some(((13))),second_portal:Some(((14))),what:Some(((14))))})),use_time:true)